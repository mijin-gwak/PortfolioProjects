---
title: "Neural Language Modeling Research"
author: "Author: Mijin Gwak"
output: html_document
sansfont: Times New Roman
fontsize: 12pt
always_allow_html: yes
---
\

## Overview
\

This repository contains the research project conducted during my research master's, focusing on investigating whether neural language models exhibit aspects of human bilingual sentence processing. The work, based on the insights presented by Frank (2021), involves the training and testing of bilingual Long Short-Term Memory (LSTM) language models. Unfortunately, the code for the training process couldn't be included due to copyright restrictions. However, I have uploaded the process of calculating and plotting the garden-path effects from the experiments.
\
\

## Research Description
\

In this research project:
\
\
<ul>
  <li><strong>Objective:</strong> Explore the aspects of human bilingual sentence processing in neural language models.</li>
</ul>
- **Methodology:** Bilingual LSTM language models were trained on a substantial dataset comprising nearly 17 million Dutch and English sentences.\
- **Testing:** Models were tested on sentences with local structural ambiguity (garden-path sentences) derived from human reading-time experiments.\
- **Measurement:** The simulated garden-path effect was measured by comparing surprisal values of the critical (disambiguating) word between ambiguous and unambiguous versions of test sentences.\
- **Findings:**\
  - The garden-path effect was observed, primarily induced by the NP/S-coordination ambiguity.
  - Stronger garden-path effects were noted after priming with an unambiguous structure.
  - Within-language priming proved more effective than between-language priming.
  - Priming had a more pronounced effect on garden-pathing with a favorable thematic condition.
  - Additional experiments, reducing the training corpus for one language by half, yielded consistent results.
  - The garden-path effect was analyzed concerning target sentence proficiency, revealing stronger effects with high proficiency (L1) than low proficiency (L2).
- **Conclusion:** The results suggest that LSTMs exhibit human-like structural adaptation within and across languages.\
\

## Key Concepts
\

#### NP/S-coordination Ambiguity
\

The NP/S-coordination ambiguity refers to a local syntactic ambiguity in a sentence where a noun phrase (NP) could be interpreted either as part of an object NP conjunction or as the beginning of a new clause. In the context of this research, the ambiguity arises in sentences such as:\
\

(1a) The wizard guards the king and the princess protects the prince with her life.\
(1b) The wizard guards the king, and the princess protects the prince with her life.\
\

The disambiguation occurs when the critical verb ("protects") is encountered, leading to increased reading time in ambiguous sentences compared to unambiguous variants.\
\

#### Local Structural Ambiguity
\

Local structural ambiguity, often referred to as garden-path sentences, occurs when a sentence contains elements that mislead the reader initially, causing temporary confusion or a "garden-path" effect. In the context of this research, the garden-path sentences involve NP/S-coordination ambiguity, and the models were tested on their ability to navigate and adapt to such local structural ambiguities.\
\

## Additional Experiment
\

An extra experiment involved reducing the training corpus for one language by half:
- Specifically, 50% of the English training corpus was removed to elicit an L1 Dutch - L2 English model.
- Similarly, 50% of the Dutch training corpus was removed to elicit an L1 Dutch - L2 English model.
- Results from this experiment were consistent with the findings of the initial experiment.\
\

## Reference
\

- Frank, S.L. (2021), "Towards computational models of multilingual sentence processing," Language Learning 71, pp. 193–218.
\
\

---
\

## I  Preliminaries

### 1. R Packages Used

```{r, message=FALSE}
library(tidyverse) # general tools
library(ggplot2) # plots
library(DiagrammeR) # flowcharts
```

### 2. Types of Priming

There are two *prime types* and *target types*, respectively (i.e., ambiguous, unambiguous), two *prime languages* and *target languages*, respectively (i.e., Dutch, English) as below. This priming procedure was performed with two *thematic fit conditions* (i.e., good, bad), which elicits 32 conditions (2x2x2x2x2) in total.
```{r, echo=FALSE}
grViz("digraph flowchart {
      node [fontname = Times, fontsize = 12, shape = rectangle];
      rankdir = LR;
      edge[arrowhead = 'none']
      
      tab1 [label = 'Prime Type']
      tab2 [label = 'Ambiguous']
      tab3 [label = 'Unambiguous']
      tab26 [label = 'Prime Language']
      tab4 [label = 'Dutch']
      tab5 [label = 'English']
      tab8 [label = 'nl_amb']
      tab9 [label = 'en_amb']
      tab10 [label = 'nl_unamb']
      tab11 [label = 'en_unamb']
      
      tab12 [label = 'Target Type']
      tab13 [label = 'Ambiguous']
      tab14 [label = 'Unambiguous']
      tab27 [label = 'Target Language']
      tab15 [label = 'Dutch']
      tab16 [label = 'English']
      tab19 [label = 'nl_amb']
      tab20 [label = 'en_amb']
      tab21 [label = 'nl_unamb']
      tab22 [label = 'en_unamb']

      # edge definitions with the node IDs
      
      tab1 -> tab2;
      tab1 -> tab3;
      tab2 -> tab26;
      tab3 -> tab26;
      tab26 -> tab4 -> tab8 -> tab12;
      tab4 -> tab10 -> tab12;
      tab26 -> tab5 -> tab9 -> tab12;
      tab5 -> tab11 -> tab12;
      tab12 -> tab13;
      tab12 -> tab14;
      tab13 -> tab27;
      tab14 -> tab27;
      tab27 -> tab15 -> tab19;
      tab15 -> tab21;
      tab27 -> tab16 -> tab20;
      tab16 -> tab22
      }
      ")
```
### 3. Garden-Path Effect
\
Garden-path effect refers to the surprisal difference between the unambiguous and ambiguous targets of the same priming condition (i.e., nl_amb, nl_unamb, en_amb, en_unamb). Therefore, target type is removed from the condition which results in 8 conditions (2x2x2) per thematic condition, and 16 conditions in total:
```{r, echo=FALSE}
grViz("digraph flowchart {
      node [fontname = Times, fontsize = 12, shape = rectangle];
      rankdir = LR;
      edge[arrowhead = 'none']
      
      tab1 [label = 'Prime Type']
      tab2 [label = 'Ambiguous']
      tab3 [label = 'Unambiguous']
      tab26 [label = 'Prime Language']
      tab4 [label = 'Dutch']
      tab5 [label = 'English']
      tab8 [label = 'nl_amb']
      tab9 [label = 'en_amb']
      tab10 [label = 'nl_unamb']
      tab11 [label = 'en_unamb']
      
      tab27 [label = 'Target Language']
      tab15 [label = 'Dutch']
      tab16 [label = 'English']

      # edge definitions with the node IDs
      
      tab1 -> tab2;
      tab1 -> tab3;
      tab2 -> tab26;
      tab3 -> tab26;
      tab26 -> tab4 -> tab8 -> tab27;
      tab4 -> tab10 -> tab27;
      tab26 -> tab5 -> tab9 -> tab27;
      tab27 -> tab15;
      tab27 -> tab16;
      tab5 -> tab11 -> tab27
      }
      ")
```
## II  Prime Tests Results
\

### 1. First Experiment
\
In the first experiment, the Five Long short-term memory (Hochreiter & Schmidhuber, 1997) RNN models, differing only in random initial connection weights, were trained on next-word prediction for Dutch and English. The training corpus consisted of nearly 17 million sentences (225 million word tokens) scraped from web sources (Schäfer, 2015).

In order to analyze the garden-path effect, the surprisal differences *surpdiffs* will be categorized by *prime type* (i.e., ambiguous, unambiguous), and *language pair* (i.e., within-language, between-language) for each thematic fit condition:
```{r, echo=FALSE}
grViz("digraph flowchart {
      rankdir = LR;
      node [fontname = Times, fontsize = 10, height = 0, width = 0, shape = rectangle];
      edge[arrowhead = 'none']
      
      tab1 [label = 'Prime Type']
      tab2 [label = 'Ambiguous']
      tab3 [label = 'Unambiguous']
      tab4 [label = 'Language Pair']
      tab5 [label = 'Within']
      tab6 [label = 'Between']
      
      tab1 -> tab2 -> tab4 -> tab5
      tab1 -> tab3 -> tab4 -> tab6}")
```
The following function calculates surprisal differences between two prime types (i.e., ambiguous - unambiguous) and adds relevant labels (i.e., prime type, language pair, target sentence proficiency). \

param *df*: dataframe of prime test results \
param *prime_type*: prime type of the values \
param *target_amb*: values of ambiguous target type which will subtract \
param *target_unamb*: values of unambiguous target type \
*return*: a dataframe with surprisal differences, prime type and language pair
```{r}
calculate_surpdiffs_1 <- function(df, prime_type, target_amb, target_unamb){
  
  # select values with which to calculate the differences in surprisal
  
  df_target_amb <- df[df$prime_type == prime_type &
                        df$target_type == target_amb & 
                        df$prime_nr != df$target_nr,] # exclude identity priming
  
  df_target_unamb <- df[df$prime_type == prime_type &
                          df$target_type == target_unamb & 
                          df$prime_nr != df$target_nr,]
  
  # calculate surprisal differences
  
  surpdiffs <- as.data.frame(df_target_amb$surp - df_target_unamb$surp) %>% 
    setNames('surpdiffs')
  
  # Create a new column for prime type
  # Assign 'Ambiguous' when the prime type is either 'amb_nl' or 'amb_en'
  # Assign 'Ambiguous' when the prime type is either 'unamb_nl' or 'unamb_en'
  
  amb <- c('nl_amb', 'en_amb')
  unamb <- c('nl_unamb', 'en_unamb')
  
  surpdiffs$prime_type <- ifelse(is.element(prime_type, amb), 'Ambiguous', 'Unambiguous')
  
  # Create a new column for language pair
  # Assign 'within' when the first two letters of prime type (i.e., nl, en) are equal to the first two letters of target type
  # Assign 'cross' when they are not equal
  
  surpdiffs$language_pair <- ifelse(substr(prime_type, 1, 2) == substr(target_amb, 1, 2), 'Within', 'Between')

  return(surpdiffs)
  
  }
```
\

#### 1.1. *Good* Thematic Condition
\

Retrieving data:
```{r}
exper1_good <- read.csv('LSTM_1_17750580_good.csv') %>% 
  select(prime_type, target_type, prime_nr, target_nr, surp)
```

```{r, echo=FALSE}
head(exper1_good)
```
\

Calculating garden-path effect with *calculate_surpdiffs_1* function for each priming condition:
```{r}
# Prime type: Ambiguous

exper1_good_1 <- calculate_surpdiffs_1(exper1_good, 'nl_amb', 'nl_amb', 'nl_unamb')
exper1_good_2 <- calculate_surpdiffs_1(exper1_good, 'nl_amb', 'en_amb', 'en_unamb')
exper1_good_3 <- calculate_surpdiffs_1(exper1_good, 'en_amb', 'nl_amb', 'nl_unamb')
exper1_good_4 <- calculate_surpdiffs_1(exper1_good, 'en_amb', 'en_amb', 'en_unamb')

# Prime type: Unambiguous

exper1_good_5 <- calculate_surpdiffs_1(exper1_good, 'nl_unamb', 'nl_amb', 'nl_unamb')
exper1_good_6 <- calculate_surpdiffs_1(exper1_good, 'nl_unamb', 'en_amb', 'en_unamb')
exper1_good_7 <- calculate_surpdiffs_1(exper1_good, 'en_unamb', 'nl_amb', 'nl_unamb')
exper1_good_8 <- calculate_surpdiffs_1(exper1_good, 'en_unamb', 'en_amb', 'en_unamb')

```
\

Combining the results from all the priming conditions: 
```{r}
exper1_good_results <- rbind(exper1_good_1, exper1_good_2, exper1_good_3, exper1_good_4, 
                             exper1_good_5, exper1_good_6, exper1_good_7, exper1_good_8)
```

```{r, echo=FALSE}
head(exper1_good_results)
```
\

#### 1.2. *Bad* Thematic Condition
\

Retrieving data:
```{r}
exper1_bad <- read.csv('LSTM_1_17750580_bad.csv') %>% 
  select(prime_type, target_type, prime_nr, target_nr, surp)
```

```{r, echo=FALSE}
head(exper1_bad)
```
\

Calculating garden-path effect with *calculate_surpdiffs_1* function for each priming condition:
```{r}
# Prime type: Ambiguous

exper1_bad_1 <- calculate_surpdiffs_1(exper1_bad, 'nl_amb', 'nl_amb', 'nl_unamb')
exper1_bad_2 <- calculate_surpdiffs_1(exper1_bad, 'nl_amb', 'en_amb', 'en_unamb')
exper1_bad_3 <- calculate_surpdiffs_1(exper1_bad, 'en_amb', 'nl_amb', 'nl_unamb')
exper1_bad_4 <- calculate_surpdiffs_1(exper1_bad, 'en_amb', 'en_amb', 'en_unamb')

# Prime type: Unambiguous

exper1_bad_5 <- calculate_surpdiffs_1(exper1_bad, 'nl_unamb', 'nl_amb', 'nl_unamb')
exper1_bad_6 <- calculate_surpdiffs_1(exper1_bad, 'nl_unamb', 'en_amb', 'en_unamb')
exper1_bad_7 <- calculate_surpdiffs_1(exper1_bad, 'en_unamb', 'nl_amb', 'nl_unamb')
exper1_bad_8 <- calculate_surpdiffs_1(exper1_bad, 'en_unamb', 'en_amb', 'en_unamb')

```
\

Combining the results from all the priming conditions: 
```{r}
exper1_bad_results <- rbind(exper1_bad_1, exper1_bad_2, exper1_bad_3, exper1_bad_4, 
                            exper1_bad_5, exper1_bad_6, exper1_bad_7, exper1_bad_8)
```

```{r, echo=FALSE}
head(exper1_bad_results)
```
\

### 2. Second Experiment
\
In the second experiment, the training corpus for *one language* was reduced by half resulting in about 13 million in total. Specifically, 50% of the English training corpus was removed to elicit an L1 Dutch - L2 English model, and 50% of the Dutch training corpus was removed to elicit an L1 Dutch - L2 English model. In both models, all four types of priming (i.e., nl_amb, nl_unamb, en_amb, en_unamb) were performed.

The garden-path effect in this experiment will be analyzed in the same way as the first experiment, but the target sentence proficiency (i.e., L1, L2) was also taken into account:
```{r, echo=FALSE}
grViz("digraph flowchart {
      rankdir = LR;
      node [fontname = Times, fontsize = 10, height = 0, width = 0, shape = rectangle];
      edge[arrowhead = 'none']
      
      tab1 [label = 'Prime Type']
      tab2 [label = 'Ambiguous']
      tab3 [label = 'Unambiguous']
      tab4 [label = 'Language Pair']
      tab5 [label = 'Within']
      tab6 [label = 'Between']
      tab7 [label = 'Target Sentence Proficiency']
      tab8 [label = 'L1']
      tab9 [label = 'L2']
      
      tab1 -> tab2 -> tab4 -> tab5 -> tab7 -> tab8
      tab1 -> tab3 -> tab4 -> tab6 -> tab7 -> tab9}")
```
The prime tests were performed for both L1 Dutch - L2 English model and L1 Dutch - L2 English model independently, and therefore the results are documented in two separate files. The surprisal differences will be calculated separately, then labels will be added for prime type, language pair, and target sentence proficiency to each model. Finally, the results from the two models will be combined for the garden-path effect analysis. 

The following function calculates surprisal differences between two prime types (i.e., ambiguous - unambiguous) and adds relevant labels (i.e., prime type, language pair, target sentence proficiency): \

param *df*: dataframe of prime test results \
param *prime_type*: prime type of the values \
param *target_amb*: values of ambiguous target type which will subtract \
param *target_unamb*: values of unambiguous target type \
param *L1*: L1 of the model for which full training corpus was used \
*return*: a dataframe with surprisal differences, prime type, language pair, and target sentence proficiency
```{r}
calculate_surpdiffs_2 <- function(df, prime_type, target_amb, target_unamb, L1){
  
  # select values with which to calculate the differences in surprisal
  
  df_target_amb <- df[df$prime_type == prime_type &
                        df$target_type == target_amb & 
                        df$prime_nr != df$target_nr,] # exclude identity priming
  
  df_target_unamb <- df[df$prime_type == prime_type &
                          df$target_type == target_unamb & 
                          df$prime_nr != df$target_nr,]
  
  # calculate surprisal differences
  
  surpdiffs <- as.data.frame(df_target_amb$surp - df_target_unamb$surp) %>% 
    setNames('surpdiffs')
  
  # Create a new column for prime type
  # Assign 'Ambiguous' when the prime type is either 'amb_nl' or 'amb_en'
  # Assign 'Ambiguous' when the prime type is either 'unamb_nl' or 'unamb_en'
  
  amb <- c('nl_amb', 'en_amb')
  unamb <- c('nl_unamb', 'en_unamb')
  
  surpdiffs$prime_type <- ifelse(is.element(prime_type, amb), 'Ambiguous', 'Unambiguous')
  
  # Create a new column for language pair
  # Assign 'within' when the first two letters of prime type (i.e., nl, en) are equal to the first two letters of target type
  # Assign 'cross' when they are not equal
  
  surpdiffs$language_pair <- ifelse(substr(prime_type, 1, 2) == substr(target_amb, 1, 2), 'Within', 'Between')
  
  # Create a new column for target sentence proficiency
  # Assign 'L1' when the L1 parameter equals to the first two letters of target type
  # Assign 'L2' when they are not equal
  
  surpdiffs$target_prof<- ifelse(L1 == substr(target_amb, 1, 2), 'L1', 'L2')
  
  return(surpdiffs)
  
  }
```
\

#### 2.1. L1 Dutch - L2 English Model
\

##### 2.1.1. *Good* Thematic Condition
\

Retrieving data:
```{r}
nl_en_good <- read.csv('LSTM_1_13363796_nl_en_good.csv') %>% 
  select(prime_type, target_type, prime_nr, target_nr, surp)
```

```{r, echo=FALSE}
head(nl_en_good)
```
\

Calculating garden-path effect with *calculate_surpdiffs_2* function for each priming condition:
```{r}
# Prime type: Ambiguous

nl_en_good_1 <- calculate_surpdiffs_2(nl_en_good, 'nl_amb', 'nl_amb', 'nl_unamb', 'nl')
nl_en_good_2 <- calculate_surpdiffs_2(nl_en_good, 'nl_amb', 'en_amb', 'en_unamb', 'nl')
nl_en_good_3 <- calculate_surpdiffs_2(nl_en_good, 'en_amb', 'nl_amb', 'nl_unamb', 'nl')
nl_en_good_4 <- calculate_surpdiffs_2(nl_en_good, 'en_amb', 'en_amb', 'en_unamb', 'nl')

# Prime type: Unambiguous

nl_en_good_5 <- calculate_surpdiffs_2(nl_en_good, 'nl_unamb', 'nl_amb', 'nl_unamb', 'nl')
nl_en_good_6 <- calculate_surpdiffs_2(nl_en_good, 'nl_unamb', 'en_amb', 'en_unamb', 'nl')
nl_en_good_7 <- calculate_surpdiffs_2(nl_en_good, 'en_unamb', 'nl_amb', 'nl_unamb', 'nl')
nl_en_good_8 <- calculate_surpdiffs_2(nl_en_good, 'en_unamb', 'en_amb', 'en_unamb', 'nl')

```
\

Combining the results from all the priming conditions:
```{r}
nl_en_good_results <- rbind(nl_en_good_1, nl_en_good_2, nl_en_good_3, nl_en_good_4, 
                            nl_en_good_5, nl_en_good_6, nl_en_good_7, nl_en_good_8)
```

```{r, echo=FALSE}
head(nl_en_good_results)
```
\

#### 2.1.2. *Bad* Thematic Condition
\

Retrieving data:
```{r}
nl_en_bad <- read.csv('LSTM_1_13363796_nl_en_bad.csv') %>% 
  select(prime_type, target_type, prime_nr, target_nr, surp)
```

```{r, echo=FALSE}
head(nl_en_bad)
```
\

Calculating garden-path effect with *calculate_surpdiffs_2* function for each priming condition:
```{r, warning=FALSE}
# Prime type: Ambiguous

nl_en_bad_1 <- calculate_surpdiffs_2(nl_en_bad, 'nl_amb', 'nl_amb', 'nl_unamb', 'nl')
nl_en_bad_2 <- calculate_surpdiffs_2(nl_en_bad, 'nl_amb', 'en_amb', 'en_unamb', 'nl')
nl_en_bad_3 <- calculate_surpdiffs_2(nl_en_bad, 'en_amb', 'nl_amb', 'nl_unamb', 'nl')
nl_en_bad_4 <- calculate_surpdiffs_2(nl_en_bad, 'en_amb', 'en_amb', 'en_unamb', 'nl')

# Prime type: Unambiguous

nl_en_bad_5 <- calculate_surpdiffs_2(nl_en_bad, 'nl_unamb', 'nl_amb', 'nl_unamb', 'nl')
nl_en_bad_6 <- calculate_surpdiffs_2(nl_en_bad, 'nl_unamb', 'en_amb', 'en_unamb', 'nl')
nl_en_bad_7 <- calculate_surpdiffs_2(nl_en_bad, 'en_unamb', 'nl_amb', 'nl_unamb', 'nl')
nl_en_bad_8 <- calculate_surpdiffs_2(nl_en_bad, 'en_unamb', 'en_amb', 'en_unamb', 'nl')

```
\

Combining the results from all the priming conditions:
```{r}
nl_en_bad_results <- rbind(nl_en_bad_1, nl_en_bad_2, nl_en_bad_3, nl_en_bad_4, 
                           nl_en_bad_5, nl_en_bad_6, nl_en_bad_7, nl_en_bad_8)
```

```{r, echo=FALSE}
head(nl_en_bad_results)
```
\

#### 2.2. L1 English - L2 Dutch Model
\

##### 2.2.1. *Good* Thematic Condition
\

Retrieving data:
```{r}
en_nl_good <- read.csv('LSTM_1_13262074_en_nl_good.csv') %>% 
  select(prime_type, target_type, prime_nr, target_nr, surp)
```

```{r, echo=FALSE}
head(en_nl_good)
```
\

Calculating garden-path effect with *calculate_surpdiffs_2* function for each priming condition:
```{r}
# Prime type: Ambiguous

en_nl_good_1 <- calculate_surpdiffs_2(en_nl_good, 'nl_amb', 'nl_amb', 'nl_unamb', 'en')
en_nl_good_2 <- calculate_surpdiffs_2(en_nl_good, 'nl_amb', 'en_amb', 'en_unamb', 'en')
en_nl_good_3 <- calculate_surpdiffs_2(en_nl_good, 'en_amb', 'nl_amb', 'nl_unamb', 'en')
en_nl_good_4 <- calculate_surpdiffs_2(en_nl_good, 'en_amb', 'en_amb', 'en_unamb', 'en')

# Prime type: Unambiguous

en_nl_good_5 <- calculate_surpdiffs_2(en_nl_good, 'nl_unamb', 'nl_amb', 'nl_unamb', 'en')
en_nl_good_6 <- calculate_surpdiffs_2(en_nl_good, 'nl_unamb', 'en_amb', 'en_unamb', 'en')
en_nl_good_7 <- calculate_surpdiffs_2(en_nl_good, 'en_unamb', 'nl_amb', 'nl_unamb', 'en')
en_nl_good_8 <- calculate_surpdiffs_2(en_nl_good, 'en_unamb', 'en_amb', 'en_unamb', 'en')

```
\

Combining the results from all the priming conditions:
```{r}
en_nl_good_results <- rbind(en_nl_good_1, en_nl_good_2, en_nl_good_3, en_nl_good_4, 
                            en_nl_good_5, en_nl_good_6, en_nl_good_7, en_nl_good_8)
```

```{r, echo=FALSE}
head(en_nl_good_results)
```
\

#### 2.2.2. *Bad* Thematic Condition
\

Retrieving data:
```{r}
en_nl_bad <- read.csv('LSTM_1_13262074_en_nl_bad.csv') %>% 
  select(prime_type, target_type, prime_nr, target_nr, surp)
```

```{r, echo=FALSE}
head(en_nl_bad)
```
\

Calculating garden-path effect with *calculate_surpdiffs_2* function for each priming condition:
```{r}
# Prime type: Ambiguous

en_nl_bad_1 <- calculate_surpdiffs_2(en_nl_bad, 'nl_amb', 'nl_amb', 'nl_unamb', 'en')
en_nl_bad_2 <- calculate_surpdiffs_2(en_nl_bad, 'nl_amb', 'en_amb', 'en_unamb', 'en')
en_nl_bad_3 <- calculate_surpdiffs_2(en_nl_bad, 'en_amb', 'nl_amb', 'nl_unamb', 'en')
en_nl_bad_4 <- calculate_surpdiffs_2(en_nl_bad, 'en_amb', 'en_amb', 'en_unamb', 'en')

# Prime type: Unambiguous

en_nl_bad_5 <- calculate_surpdiffs_2(en_nl_bad, 'nl_unamb', 'nl_amb', 'nl_unamb', 'en')
en_nl_bad_6 <- calculate_surpdiffs_2(en_nl_bad, 'nl_unamb', 'en_amb', 'en_unamb', 'en')
en_nl_bad_7 <- calculate_surpdiffs_2(en_nl_bad, 'en_unamb', 'nl_amb', 'nl_unamb', 'en')
en_nl_bad_8 <- calculate_surpdiffs_2(en_nl_bad, 'en_unamb', 'en_amb', 'en_unamb', 'en')

```
\

Combining the results from all the priming conditions:
```{r}
en_nl_bad_results <- rbind(nl_en_bad_1, nl_en_bad_2, nl_en_bad_3, nl_en_bad_4, nl_en_bad_5, nl_en_bad_6, nl_en_bad_7, nl_en_bad_8)
```

```{r, echo=FALSE}
head(en_nl_bad_results)
```
\

#### 2.3. Combining results from L1 Dutch - L2 English Model and L1 English - L2 Dutch Model
\

##### 2.3.1. *Good* Thematic Condition
\


```{r}
exper2_good_results <- rbind(nl_en_good_results, en_nl_good_results)
```
```{r, echo=FALSE}
head(exper2_good_results)
```
\

##### 2.3.1. *Bad* Thematic Condition
\


```{r}
exper2_bad_results <- rbind(nl_en_bad_results, en_nl_bad_results)
```

```{r, echo=FALSE}
head(exper2_bad_results)
```
\

## III  Plots
\

In order to plot the results, we first need to summarize them. Below is the format of converting the grouping variables *IV_1*, *IV_2* of a dataframe *df* to factors, and calculating the means and confidence intervals of the dependent variable *DV* (i.e., surprisal differences) on the independent variables.
```{r, eval=FALSE}
df %>% 
  mutate(IV_1 = factor(IV_1),
         IV_2 = factor(IV_2)) %>% 
  group_by(IV_1, IV_2) %>% 
  summarise(
    DV_mean = mean(DV),
    DV_ci   = 1.96 * sd(DV)/sqrt(n())) # standard error of the mean, and multiplying this by 1.96 gives us 
                                       #the distance from the mean to the 95% interval boundary 
                                       #(which we then add or subtract from the mean later in the plot)
    )
  }
```
\

Finally, below is the format of plotting the summarized data in which *df_summary* is a dataframe of the summarized data, *x_label* and *y_label* indicate what x-axis and y-axis denote which correspond to one of the independent variables, *IV_1* or *IV_2*, and the dependent variable, *DV*. *DV_mean* and *DV_ci* refer to the column names that have means and confidence intervals of the dependent variable. Lastly, the title of the graph consists of *title_line_1* and *title_line_2* which refer to the first line and second line of the title, respectively. *legend_title* is the title of the legend which specifies the grouping variable. 
```{r, eval=FALSE}
df_summary %>% 
  ggplot(aes(x = IV_1, y = DV_mean, group = IV_2)) +
  geom_line(aes(linetype = IV_2)) +
  geom_errorbar(aes(ymin = DV_mean - DV_ci, ymax = DV_mean + DV_ci),
                width = .1, linetype = 1) +
  geom_point(size = 2) +
  geom_point(size = 1, color = "white") +
  guides(linetype = guide_legend(legend)) +
  labs(title = paste(title_line_1,
                     title_line_2,
                     " ",
                     sep = "\n"),
       caption = paste(" ",
                       "Error bar: 95% CI",
                       sep = "\n"),
       x = x_label,
       y = y_label) +
  theme(
    legend.title = element_text(family = size = 10),
    panel.background = element_rect(fill = "white"),
    legend.key  = element_rect(fill = "white"),    
    axis.line.x = element_line(colour = "black", size = 1),
    axis.line.y = element_line(colour = "black", size = 1))
```
\

### 1. First Experiment
\

#### 1.1. *Good* Thematic Condition
\

Data summary:
```{r, message=FALSE}
exper1_good_summary <- exper1_good_results %>% 
  mutate(prime_type = factor(prime_type),
         language_pair = factor(language_pair)) %>% 
  group_by(prime_type, language_pair) %>% 
  summarise(
    surpdiffs_mean = mean(surpdiffs),
    surpdiffs_ci   = 1.96 * sd(surpdiffs)/sqrt(n()))
```

```{r, echo=FALSE}
head(exper1_good_summary)
```
\

Plot:
```{r, echo=FALSE, warning=FALSE}
exper1_good_summary %>% 
  ggplot(aes(x = prime_type, y = surpdiffs_mean, group = language_pair)) +
  geom_line(aes(linetype = language_pair)) +
  geom_errorbar(aes(ymin = surpdiffs_mean - surpdiffs_ci, ymax = surpdiffs_mean + surpdiffs_ci),
                width = .1, linetype = 1) +
  geom_point(size = 2) +
  geom_point(size = 1, color = "white") +
  guides(linetype = guide_legend('Language Pair')) +
  labs(title = paste('Mean Garden Path Effect After Within- or Between- Language Priming',
                     '          with Ambiguous or Unambiguous Prime Sentences',
                     " ",
                     sep = "\n"),
       caption = paste(" ",
                       "Error bar: 95% CI",
                       sep = "\n"),
       x = 'Prime Type',
       y = 'Garden Path Effect (Surprisal Difference)') +
  theme(
    legend.title = element_text(size = 10),
    panel.background = element_rect(fill = "white"),
    legend.key  = element_rect(fill = "white"),    
    axis.line.x = element_line(colour = "black", size = 1),
    axis.line.y = element_line(colour = "black", size = 1))
```
\
\

#### 1.2. *Bad* Thematic Condition
\

```{r, message=FALSE}
exper1_bad_summary <- exper1_bad_results %>% 
  mutate(prime_type = factor(prime_type),
         language_pair = factor(language_pair)) %>% 
  group_by(prime_type, language_pair) %>% 
  summarise(
    surpdiffs_mean = mean(surpdiffs),
    surpdiffs_ci   = 1.96 * sd(surpdiffs)/sqrt(n()))
```

```{r, echo=FALSE}
head(exper1_bad_summary)
```
\

```{r, echo=FALSE, warning=FALSE}
exper1_bad_summary %>% 
  ggplot(aes(x = prime_type, y = surpdiffs_mean, group = language_pair)) +
  geom_line(aes(linetype = language_pair)) +
  geom_errorbar(aes(ymin = surpdiffs_mean - surpdiffs_ci, ymax = surpdiffs_mean + surpdiffs_ci),
                width = .1, linetype = 1) +
  geom_point(size = 2) +
  geom_point(size = 1, color = "white") +
  guides(linetype = guide_legend('Language Pair')) +
  labs(title = paste('Mean Garden Path Effect After Within- or Between- Language Priming',
                     '          with Ambiguous or Unambiguous Prime Sentences',
                     " ",
                     sep = "\n"),
       caption = paste(" ",
                       "Error bar: 95% CI",
                       sep = "\n"),
       x = 'Prime Type',
       y = 'Garden Path Effect (Surprisal Difference)') +
  theme(
    legend.title = element_text(size = 10),
    panel.background = element_rect(fill = "white"),
    legend.key  = element_rect(fill = "white"),    
    axis.line.x = element_line(colour = "black", size = 1),
    axis.line.y = element_line(colour = "black", size = 1))
```
\
\

### 2. Second Experiment
\

#### 2.1. The Effect of Language Pair
\

##### 2.1.1. *Good* Thematic Condition
\

```{r, message=FALSE}
exper2_good_summary_1 <- exper2_good_results %>% 
  mutate(prime_type = factor(prime_type),
         language_pair = factor(language_pair)) %>% 
  group_by(prime_type, language_pair) %>% 
  summarise(
    surpdiffs_mean = mean(surpdiffs),
    surpdiffs_ci   = 1.96 * sd(surpdiffs)/sqrt(n()))
```

```{r, echo=FALSE}
head(exper2_good_summary_1)
```
\

```{r, echo=FALSE, warning=FALSE}
exper2_good_summary_1 %>% 
  ggplot(aes(x = prime_type, y = surpdiffs_mean, group = language_pair)) +
  geom_line(aes(linetype = language_pair)) +
  geom_errorbar(aes(ymin = surpdiffs_mean - surpdiffs_ci, ymax = surpdiffs_mean + surpdiffs_ci),
                width = .1, linetype = 1) +
  geom_point(size = 2) +
  geom_point(size = 1, color = "white") +
  guides(linetype = guide_legend('Language Pair')) +
  labs(title = paste('      Mean Garden Path Effect After Ambiguous or Unambiguous',
                     '              Prime Sentences With L1 or L2 Target Sentences',
                     " ",
                     sep = "\n"),
       caption = paste(" ",
                       "Error bar: 95% CI",
                       sep = "\n"),
       x = 'Prime Type',
       y = 'Garden Path Effect (Surprisal Difference)') +
  theme(
    legend.title = element_text(size = 10),
    panel.background = element_rect(fill = "white"),
    legend.key  = element_rect(fill = "white"),    
    axis.line.x = element_line(colour = "black", size = 1),
    axis.line.y = element_line(colour = "black", size = 1))
```
\
\

##### 2.1.2. *Bad* Thematic Condition
\

```{r, message=FALSE}
exper2_bad_summary_1 <- exper2_bad_results %>% 
  mutate(prime_type = factor(prime_type),
         language_pair = factor(language_pair)) %>% 
  group_by(prime_type, language_pair) %>% 
  summarise(
    surpdiffs_mean = mean(surpdiffs),
    surpdiffs_ci   = 1.96 * sd(surpdiffs)/sqrt(n()))
```

```{r, echo=FALSE}
head(exper2_bad_summary_1)
```
\

```{r, echo=FALSE, warning=FALSE}
exper2_bad_summary_1 %>% 
  ggplot(aes(x = prime_type, y = surpdiffs_mean, group = language_pair)) +
  geom_line(aes(linetype = language_pair)) +
  geom_errorbar(aes(ymin = surpdiffs_mean - surpdiffs_ci, ymax = surpdiffs_mean + surpdiffs_ci),
                width = .1, linetype = 1) +
  geom_point(size = 2) +
  geom_point(size = 1, color = "white") +
  guides(linetype = guide_legend('Language Pair')) +
  labs(title = paste('      Mean Garden Path Effect After Ambiguous or Unambiguous',
                     '              Prime Sentences With L1 or L2 Target Sentences',
                     " ",
                     sep = "\n"),
       caption = paste(" ",
                       "Error bar: 95% CI",
                       sep = "\n"),
       x = 'Prime Type',
       y = 'Garden Path Effect (Surprisal Difference)') +
  theme(
    legend.title = element_text(size = 10),
    panel.background = element_rect(fill = "white"),
    legend.key  = element_rect(fill = "white"),    
    axis.line.x = element_line(colour = "black", size = 1),
    axis.line.y = element_line(colour = "black", size = 1))
```
\
\

#### 2.2. The Effect of Target Sentence Proficiency 
\

##### 2.2.1. *Good* Thematic Condition
\

```{r, message=FALSE}
exper2_good_summary_2 <- exper2_good_results %>% 
  mutate(prime_type = factor(prime_type),
         target_prof = factor(target_prof)) %>% 
  group_by(prime_type, target_prof) %>% 
  summarise(
    surpdiffs_mean = mean(surpdiffs),
    surpdiffs_ci   = 1.96 * sd(surpdiffs)/sqrt(n()))
```

```{r, echo=FALSE}
head(exper2_good_summary_2)
```
\

```{r, echo=FALSE, warning=FALSE}
exper2_good_summary_2 %>% 
  ggplot(aes(x = prime_type, y = surpdiffs_mean, group = target_prof)) +
  geom_line(aes(linetype = target_prof)) +
  geom_errorbar(aes(ymin = surpdiffs_mean - surpdiffs_ci, ymax = surpdiffs_mean + surpdiffs_ci),
                width = .1, linetype = 1) +
  geom_point(size = 2) +
  geom_point(size = 1, color = "white") +
  guides(linetype = guide_legend('Target Sentence')) +
  labs(title = paste('          Mean Garden Path Effect After Ambiguous or Unambiguous',
                     '                Prime Sentences With L1 or L2 Target Sentences',
                     " ",
                     sep = "\n"),
       caption = paste(" ",
                       "Error bar: 95% CI",
                       sep = "\n"),
       x = 'Prime Type',
       y = 'Garden Path Effect (Surprisal Difference)') +
  theme(
    legend.title = element_text(size = 10),
    panel.background = element_rect(fill = "white"),
    legend.key  = element_rect(fill = "white"),    
    axis.line.x = element_line(colour = "black", size = 1),
    axis.line.y = element_line(colour = "black", size = 1))
```
\
\

##### 2.2.2. *Bad* Thematic Condition
\

```{r, message=FALSE}
exper2_bad_summary_2 <- exper2_bad_results %>% 
  mutate(prime_type = factor(prime_type),
         target_prof = factor(target_prof)) %>% 
  group_by(prime_type, target_prof) %>% 
  summarise(
    surpdiffs_mean = mean(surpdiffs),
    surpdiffs_ci   = 1.96 * sd(surpdiffs)/sqrt(n()))
```

```{r, echo=FALSE}
head(exper2_bad_summary_2)
```
\

```{r, echo=FALSE, warning=FALSE}
exper2_bad_summary_2 %>% 
  ggplot(aes(x = prime_type, y = surpdiffs_mean, group = target_prof)) +
  geom_line(aes(linetype = target_prof)) +
  geom_errorbar(aes(ymin = surpdiffs_mean - surpdiffs_ci, ymax = surpdiffs_mean + surpdiffs_ci),
                width = .1, linetype = 1) +
  geom_point(size = 2) +
  geom_point(size = 1, color = "white") +
  guides(linetype = guide_legend('Target Sentence')) +
  labs(title = paste('          Mean Garden Path Effect After Ambiguous or Unambiguous',
                     '                  Prime Sentences With L1 or L2 Target Sentences',
                     " ",
                     sep = "\n"),
       caption = paste(" ",
                       "Error bar: 95% CI",
                       sep = "\n"),
       x = 'Prime Type',
       y = 'Garden Path Effect (Surprisal Difference)') +
  theme(
    legend.title = element_text(size = 10),
    panel.background = element_rect(fill = "white"),
    legend.key  = element_rect(fill = "white"),    
    axis.line.x = element_line(colour = "black", size = 1),
    axis.line.y = element_line(colour = "black", size = 1))
```